import generate from "@babel/generator";
import { parse } from "@babel/parser";
import * as passes from '../passes.js';
import fs from 'node:fs';

const filename = "sample-high.obf.js";
const source = fs.readFileSync(filename, "utf-8");
const ast = parse(source, { sourceFilename: filename });

// Passes go here
function _0x47ad(){var _0x172a63=['CCk+WP3cKM8','oSoWBHDH','WPPHm8oAWPW','c3hcKmk+W6C','WRFdGvFcNa0','g8ocDsD1','e8osWONcUaW','smorW7uOFW','WQ4iWQWB','WObOW6bsW78','qeRdUGT6w2vptGxdGcm','h8kIWRZdKCom','vmkIkhHl','W6xcJSkUdCop','xmk0b8klBG','v3pdPqZcMW','EmkcWO7cS3W','W49mruRdLG','WQ1ammoAWOe','W5hcP8k9kmoV','WQmdmgBdLq','B00dW53dPW','W6WDW73cJNq','W5ZcPmkVgCoR','yeRcSfNcIa','hSkiWOT5','W6f3WPXIDW','CCkbzmo/zG','WO1ugLldSq','WPfhBe9Y','WRLzW5LoW5C','WOiLW68LWQ4','WQvpW4TCW6i','a8kjW4reWRW','lmksW4OCwq','W4qYW5hdVWC','WR1iW5T7W44','cmkuWQHCWOe','W6GtW4tcIchcQci3WQ8OW5dcRSko','W4tcKmomcCkW','W7v9t0pdQG','fH7dGSkDW5W','h8kDW4TZWRS','z8kygLbE','W7qzWQ/cNXCQemkEc8oxESowgt8','W71Ayv/dNa','WPBdS1pcUrS','jtfeimo2','sSkXz8oIxW','WRf9vWH3','W4jTWPLyrG','dmkdW6FdQs8','W67cRaNcVbK','oCosWQxdGIe','WReKhNxdHG','W55of8kIEW','hmoauIzK','uuCnW4VdUW','lCk+W5Cxyq','WObXWPxcMCkQ','W4DvnmkBzq','W4pcL8kTeSol','WPHdaCo9WQe','W5VcLmoTdmky','WRnyus5r','WPxcPxlcGGm','WQFcSdFdUYu','vbVcUSkx','WOHGW6PjW7W','W7KEWOHEW5VdHCotc8ok','BLxcUg3cMW','WOzgtmkiWOG','WRW5f0JdLa','WR58C3PI','xmk6dCkRwW','ix/cTmkFW7m','WPFdPwpcRbe','WQfqW7vxgG','W7ZcL8o6fmkR','hmkaW7e/','W4pcI8kdk8oK','WOaHW7a7W78','WRvNBSkcWRG','WPtdQ3hcGtC','Dd7cPH/cRW','sHpcKSo1WOu','W5m4W6tdGrG','WR5wWRpdHeG','WRbtxCkqWPK','EmkZjgv0','WR7dK0ZcQc3dTSkkW7NcIW','WPSbW6CyWQa','xvddObvN','qhtdTbBcOW','y3BdTI3dNW','WPxdHflcVaa','j110wJy','WP8geuhdQq','dSoFWQNdSSk+','WOXLC2fx','WQ1zW5rzW4W','qItcOmkBWRO','W6FdG8kQW4HY','iuxcKCkEW6O','h8ofWOtdJa','dmoAWQ/dQcO','WPrulCozWRi','oSoCDdP0','dNPzCcW','WO9+WPJcTCkI','cHNdNCkUW6e','teRcPmorW4q','WR9CeH7dMa','WR9QW5xdRKW','WQtcLhpcUZa','W57dNCoPWPGn','W4XIWPD+ra','Bmknf8kdxa','WOuCkLNdMW','bN1WAdW','c8odWQNdTG','nmoQDWjX','WO1RW7nEW5a','W67cMmk+bCo7','a8k0WQldSSos','uMZdKGJdPq','WQH/WOpcLmkv','gSogWOZdM8kb','h8kqW44','W4tcMmkreCoW','WP0uxJ3dVa','W6dcLCoC','W4hcRaZcLt4','EmkvfSkcBq','d8keWPfuWQi','fcbQgSo5','EuK1W7xdMG','bCoRyWnt','jehcJ8k5W4u','WPX5uNbY','guXqwY8','iGNcO1SE','j8oqrs9W','WRbAWPFcNSkx','rthcS8oBWPG','FmkLi3jr','WOmBtdVdGq','q1/cQuVcRW','WRDIWOBdK1i','WQ96s8kCWPS','W7hdRCk9W5zI','W6KxW53dVZS','At/cGSkZW6G','me45ACkq','uSkBcNb1','W4CsW7VdMGi','pmktW7H9WR0','WPbNWOhdJ14','W77cJmoQh8kd','WP0QxsZdNG','W5SUW4FdGmoxW7qJW77dTNZdNcpdJa','gCkPW7S5Ca','FgxdGsdcVG','iclcTfFdOIBcNXeplZ/dJG','W6CYW4/dMHu','gmoPvZn7','hSkdWOtdISo8','W57dVmkKW5HH','jCk9W7Gcya','W6XZWPDJrW','W7nCWRnTqG','W4HRWPpcHmkt','WRPMW5j9oW','W4SoW64','W7jZk8kgya','WQPzW69oW4a','WOddO0FcIGi','WOfDW7FdSxq','uaSreCkt','W6jvmCkrBG','W5yFlumvjYFdSbRcNCoPW6hdRe4','lCkYW5aPxW','WQhcQGVdKa','mdxcQ1iJ','W73cUrpcUcy','ECkwB8obsG','WQP0W5b7W6K','emkyWO1fWQ8','ya/cPCodWPi','W69xzxhdNW','WRjvW6zpda','W6OnW6/dUdG','hwpcQgBdHq','W5dcJCkmlSoK','qeSJW7BdPW','ya7cTCoWWQe','W77cJ8oylmkh','WQXFWP7cOmkP','W4SyW4ldUaC','FuJdOtVdJG','W4VcKCotiCkg','eZFdU8kuW74','WR/cSH7dUXS','u8khbLPQ','hSoBWPhcJby','a0xcRSk0W6O','WRtcTstdOZm','WRHDWPhcICkP','WPXbr3Lf','WOa6W7e6WQm','W6moW6VdOqK','W6nQwfZdQa','c8kqWRNdKSoX','r8k9kSk4yq','WR5dWPddIG','WRvzW6H/aq','WQdcSJNdMtS','xmktu8oRzW','WODIz8kUWRS','W4mIW4ZcTu0','WO56W5HkW7C','xmkRWP3cLwG','WRGsxbC','WP1ebCoNWOe','W7ZcOCkWd8oe','FJlcMSkBW5O','nhVcSSkv','g2RcN8o9WQySW7PH','WOrcCqHr','gSopWQBdOde','WOO0of3dQq','qCkwfmkYxa','WP4FvcddHq','hCopWRxdPdm','W7rnWR5S','EIJdRHdcHG','WRDof8oaWRC','W6HiDxtdTG','WOrQWOlcGSkt','sCkBivXT','WOxdTKdcOq0','z8kFBSohFq','W5pdP07cUt3dUqPU','WP1eAY9a','bvvkusS','l8oAWPxdTYa','D8kzi0DV','WQenW796tG','yMpdPXdcTW','oCoQWQpdJ8ka','WQSdWRtcHW','fajTlmoT','C8knn8kgqG','WQtcMfBcTci','wYVcL8ogWQ8','WRbNW5zyjW','iwlcRCkxW50','qvWdW4tdTG','v3ddGrddGq','WRO9W48aWR8','DcNdKa7cHa','cConWOJdHmkd','hCkrWPvXWRu','WPyKW5q8WRO','g09vram','uZpcVSkLW70','quSrW5m','m8oLWQ/dMSke','WOjVW5/dL34','W4uuW77cTKm','ASkIWRFcRG','z8kvtSoh','W7z9FhldMW','WPzbW6zJnG','ru7dUW1+xxXAFbFdGs8','tCkzW5ldKfXdWQGsW4JcVmkuExK','W7JdJmkHW5rg','WPH3W5BcHmko','xCkinCkSza','W5RcSZJcTsi','i8obzbbp','u3/dHqS','WOBcN2VcMdq','W7ddLqldUti','W6tcOmk+','WPz0smkeWRO','imktdYHZ','WO1QW51Ycq','xmowWPyOWPy','WPeze3BdHq','eubxrqW','WPFdO0tcHbO','WQpdGgxcRZG','bCoqAGTf','E0dcU3u','WPlcTKtcHdG','W7aiW7RdHGC','WRqcW7uAWOC','z13dIGNdPG','n8o3vHrI','WRKhkhxdRq','z3VdSXtdUq','W4FcPstcPaK','W5ZcOCkyb8oH','WOmfqbBdJW','hCo2tt5p','tCk9WOpcKN0','tSk+b8k+xG','vdVdSctcLW','WRPlWPVdI38','w1dcHLtcLG','iCocdSkdpdNcQNNdSSkUW5ldP8od','W7nxsW','ldlcG0qc','WPvyFa9k','kH5bdmo4','C8k3fmkSxW','cvCAB8ko','y8kqkCkKtq','fmkDW6v+WOi','W57cMatcOIW','WRGssG3dMq','mCk6W6TIWPq','W5v5eCk7zW','vNhdJH0','pfjOycS','WRvidCooWQW','W5ysW77cQL4','W4H0iCkEwa','WQutAqZdNW','n8olqrrK','WRuzDshdMq','d8onsHKOW7tdPNacWOO3W6S','W79kWRC','EsJdTc7cOG','rmkexSo0wW','WQfOBJ1a','gtBdSG','W5GGW47dGCorW7L5W5VdPf7dQYS','WPjatCkKWP0','W6v5nSkb','aSkhW5L3','WPpcVqxcGJm','WQXAW6RdPLa','W4zyaCk2Fa','fNyMD8kI','WR0XFX/dNq','WOFdP1ZcOq','D8kYs8o0tG','tSkbWOhcVN0','WQv9CmktWRO','agjTFda','W7NcLHpcMJ8','rYFcKSklW4a','lutcT8kzW6W','W7ZcQSkRnCoc','WOm4kwddTq','wHVcG8odWOy','W7VcV8k1kSox','WQjcW50','kwycDSkP','WPXQW7tdRxe','WP4KCZ3dMq','nuRcRe0','pCo8FZrv','wh3dJH7dMW','l8kUWOhdJ8o1','e8opWP7dGCkj','eCkAW4Kuwq','qhFdSW3dNq','WPBcKXpdQHW','zwldIYxcNW','W6uKW4VdHsK','nSosuGrX','yCk9CSoKrW','iMVcImkvW40','WRFdTLVcRHi','WPLzwSkqWOq','dmoiWRlcGqO','WRvuzrvh','rM3dGW3dGa','kYvwbSoI','WQ1OW5n1W6i','CSkcWOZcUvy','WRmvvbW','W75KemkAzW','bCkBW4HGWQ4','F8k9WPJcNwi','tmkzWPlcSK4','tSkooSklzq','k8oaWPFcUIC','WRfOW6VdVxu','i1ZcUSkdW44','WQObfbVdGG','WPmGW6yFWRi','k2H0FIS','W5msW7hdGci','caZdRCk2W70','fSkEW4VdOCob','CSkbp2zx','yCkfxSohya','W5asW7NcQW','s1hdGrlcPa','pua+vSkY','qfxcU1lcUW','W7BcHJ/cPH8','W7FcTZhdUZ8','oXtdUZtdLGZcQmoTWPxdNtFdQG','sflcP23cQW','y8kUnCkMtq','hSocWQ7dVJC','l8kUWOhdJ8oU','gsZdHSkVW7i','h8orCbXC','WQPfW5rvda','WR9dW6LoW4O','AYRcMmoMWOe','wwlcQwJcSa','mulcP8kyW54','WO44W50DWPW','WOL4A2PF','ELxcG3JcMa','W4CyW6tcRfG','xmkeaKrM','oLRcKCkHW7i','WPDlW7ndlG','W5tcQWNcRfK','uq7cQmkoW4e','FCkUgSkyFa','BCkOWONcG3G','WQ8AW5GCWO8','oCocrq9Y','W5akW5/dRqu','WOzXW4VdOgK','W7/dLmkFW7X1','rtVdRtlcUG','WPrtrCkkWQG','zvlcGhFcQa','fe/dJWVdGW','A8kZACo/rW','wmkoWP7cLLW','WRHsAwnt','p8k1WO7dImo/','WPLrFCkFWPO','W5bKWQPXW68XW40zwuFcKbzg','WPXIWQ3dUNS','r8kuWQVcTNW','WO8Slh3dJG','WR1bWPFdJq','WQ1RWP/dRhK','W6pdNmkOW5jV','W4mUW4lcNgi','WQXsqmkvWOu','mrv3p8o6','CmkFu8oaEW','qNVdOGhdGq','kSojsIH9','i33cS8kiW5a','W4pdI8k4W4u','WRlcRJhdQcm','WQ1cmmoDWQO','WRddIxxcOte','fqVcUvi3','WQHyuJvT','W4CfAWLq','DuxdPaBcQa','W7hcNSk/lSoN','WOXFwCk/WPW','WPaCW6STWQ0','abtcMKO8','W65MWP1EDq','mCk0WOHoWPW','ebBcNMGN','iSojWORdLXe','W5u1W6JcRLG','WPlcO1/cKde','WOn3WP/cHa','W5hcICk8fSoq','WQRdHftcJbO','oSo/WRpdNCkh','WRPHWQHHpa','mSkAW7fdWO4','h8krW4CYW6C','W53cJIRcHWS','xey1W4VdQq','hSk1WRxdJ8oB','eSkyE2uM','D8kBWRlcOu8','r0RdVaz2vabsCr7dHYJdLa','W43cImkpdSoi','m8k5WQXyWRG','bLhcQ8kCW6m','A8k8WQpcHhy','W4pcLdpcGGy','dCoEWOxdNmkj','q3/cKM3cUa','WRFcG23cHqK','WPH8WOlcHCku','WRPfWPNdLa','W6BcNmoPkSkT','WQ9MFN15','Dmk8C8oDya','E3RdIHZdJa','qCkytSojsW','W6NcV8kPl8oA','WRLQW7bpW7O','WRbxW5FcKtG','W40zW60','i33cQmkvW5a','c8obWRxcIZu','W7vqWR96gG','A3pcOwlcPW','EetcUM8','W79vWQDjrq','bZ7cVK8i','WOTuy8k8WQS','h3mWsCkZ','WO7cN2tcOdi'];_0x47ad=function(){return _0x172a63;};return _0x47ad();}
(function(_0x3f7b6e,_0x28c310){var _0x188031=_0x2a89,_0x32d780=_0x2a89,_0x133550=_0x2a89,_0x1bfdbd=_0x2a89,_0x2716c4=_0x2a89,_0x518a8f=_0x3f7b6e();while(!![]){try{var _0xfab058=-parseInt(_0x188031(0x262,'8U)I'))/(-0x992+0x193e+0x3*-0x539)+parseInt(_0x32d780(0x1cc,'t3F&'))/(-0xfcd+-0xfd2+-0x1*-0x1fa1)+parseInt(_0x133550(0x10e,'8U)I'))/(-0xcbc+-0xe7*-0x1+0x4*0x2f6)+parseInt(_0x133550(0x1a4,'t3F&'))/(0x184*0x11+-0x9f*0x31+0x4af)+-parseInt(_0x1bfdbd(0x265,'7!$A'))/(-0x1463+0x189+-0x1*-0x12df)*(-parseInt(_0x1bfdbd(0x207,'5H&U'))/(-0x1*0x1c96+-0x1aaf+0x95*0x5f))+parseInt(_0x188031(0x2d5,'gTYN'))/(0x2c*0x1+-0x16b*-0xd+0x29*-0x74)*(-parseInt(_0x133550(0x2b4,']p8L'))/(0x183*-0x1+-0x1a99+0x709*0x4))+parseInt(_0x2716c4(0x1ee,'e3($'))/(-0x1*0x59a+0x1*-0x11a5+-0x2*-0xba4);if(_0xfab058===_0x28c310)break;else _0x518a8f['push'](_0x518a8f['shift']());}catch(_0x8897d8){_0x518a8f['push'](_0x518a8f['shift']());}}}(_0x47ad,0x167*-0x821+0x3f9*-0x19f+0x7f97f*0x4));
function _0x2a89(_0x3f2e6c,_0x445100){var _0x163553=_0x47ad();return _0x2a89=function(_0x387562,_0x17477f){_0x387562=_0x387562-(-0xdf*0x1a+0x13*0xad+0xad5*0x1);var _0x4cca7d=_0x163553[_0x387562];if(_0x2a89['Dtgkna']===undefined){var _0x4df968=function(_0x3ecad){var _0x4c509b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x8a0df6='',_0x12a772='',_0x2f6696=_0x8a0df6+_0x4df968;for(var _0x5cdbfa=0x2b*-0xc5+-0x3*0x15d+-0x1*-0x252e,_0xd05540,_0x5ff006,_0x1d0a72=0x22*-0xb1+-0x2*-0x3d3+-0x244*-0x7;_0x5ff006=_0x3ecad['charAt'](_0x1d0a72++);~_0x5ff006&&(_0xd05540=_0x5cdbfa%(0x9cf+-0x8ff+0x3*-0x44)?_0xd05540*(-0x2*-0x65+0x1*-0x25a3+0x2519)+_0x5ff006:_0x5ff006,_0x5cdbfa++%(0x1*-0x2669+-0x1*-0x431+0x139*0x1c))?_0x8a0df6+=_0x2f6696['charCodeAt'](_0x1d0a72+(0x881+0x167*-0x6+-0xd))-(-0x5+0x1438+0x1429*-0x1)!==0x51c+-0x20d4+-0x8*-0x377?String['fromCharCode'](0x267b+0x1fe7+0x1721*-0x3&_0xd05540>>(-(0x1444+-0x7c*-0x2f+-0x2b06)*_0x5cdbfa&0x11fe+0x17e8+-0x29e0)):_0x5cdbfa:0x4fe+-0x5*-0x73d+-0x292f){_0x5ff006=_0x4c509b['indexOf'](_0x5ff006);}for(var _0x1d1631=-0x1*-0x10a0+-0x795*0x3+-0x61f*-0x1,_0x163a12=_0x8a0df6['length'];_0x1d1631<_0x163a12;_0x1d1631++){_0x12a772+='%'+('00'+_0x8a0df6['charCodeAt'](_0x1d1631)['toString'](-0x1af*0xd+-0x1889*0x1+0x2e7c*0x1))['slice'](-(0x135*-0x1+-0x89b+0x9d2));}return decodeURIComponent(_0x12a772);};var _0x22f223=function(_0x2e5b85,_0x537c0c){var _0x3808f3=[],_0x425e22=-0x511*-0x7+0x1*-0x1702+0x1*-0xc75,_0x22b78d,_0x331269='';_0x2e5b85=_0x4df968(_0x2e5b85);var _0x2c64d4;for(_0x2c64d4=-0x2b*-0x9f+0x1b70+0x3625*-0x1;_0x2c64d4<-0x4*-0x25f+-0xca0+0x424;_0x2c64d4++){_0x3808f3[_0x2c64d4]=_0x2c64d4;}for(_0x2c64d4=0x3*0x1d3+-0x2*-0xcbd+-0x1ef3;_0x2c64d4<0x8*-0x20e+0x953+0x81d;_0x2c64d4++){_0x425e22=(_0x425e22+_0x3808f3[_0x2c64d4]+_0x537c0c['charCodeAt'](_0x2c64d4%_0x537c0c['length']))%(-0x2667+0x2527*0x1+0x240),_0x22b78d=_0x3808f3[_0x2c64d4],_0x3808f3[_0x2c64d4]=_0x3808f3[_0x425e22],_0x3808f3[_0x425e22]=_0x22b78d;}_0x2c64d4=-0x667*-0x1+-0x1675*-0x1+-0x1cdc,_0x425e22=-0xf*0x2+-0x44d+0x46b;for(var _0x37325b=-0x1f9f*-0x1+0xd12+-0x2cb1;_0x37325b<_0x2e5b85['length'];_0x37325b++){_0x2c64d4=(_0x2c64d4+(0xeab*-0x1+0x1843+0x997*-0x1))%(-0x14b9*0x1+-0x317+0x18d0*0x1),_0x425e22=(_0x425e22+_0x3808f3[_0x2c64d4])%(0x1f52+0x5*0x468+-0x2*0x1a2d),_0x22b78d=_0x3808f3[_0x2c64d4],_0x3808f3[_0x2c64d4]=_0x3808f3[_0x425e22],_0x3808f3[_0x425e22]=_0x22b78d,_0x331269+=String['fromCharCode'](_0x2e5b85['charCodeAt'](_0x37325b)^_0x3808f3[(_0x3808f3[_0x2c64d4]+_0x3808f3[_0x425e22])%(-0x4d*0x11+0x14cb+-0xeae)]);}return _0x331269;};_0x2a89['BnzCCU']=_0x22f223,_0x3f2e6c=arguments,_0x2a89['Dtgkna']=!![];}var _0x237ea8=_0x163553[0x1*0x1c3d+-0x13f*0x6+-0x14c3],_0x4aab6f=_0x387562+_0x237ea8,_0x2ba3e5=_0x3f2e6c[_0x4aab6f];if(!_0x2ba3e5){if(_0x2a89['RBRiiw']===undefined){var _0x5b8f5f=function(_0x363396){this['tcSUPy']=_0x363396,this['TASJQm']=[0xb16+0xcbc+-0x17d1*0x1,0x1b49+-0x1504+-0x217*0x3,0x8c8+-0x13eb*-0x1+-0x4f*0x5d],this['ZAZTpo']=function(){return'newState';},this['fXdcLD']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['pawsXD']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x5b8f5f['prototype']['sTiNgK']=function(){var _0x2ba63e=new RegExp(this['fXdcLD']+this['pawsXD']),_0x24fd1a=_0x2ba63e['test'](this['ZAZTpo']['toString']())?--this['TASJQm'][-0x24d8+-0x5*0x48f+-0xee9*-0x4]:--this['TASJQm'][0x2185+-0x141+0x24e*-0xe];return this['KFCtMe'](_0x24fd1a);},_0x5b8f5f['prototype']['KFCtMe']=function(_0x2d9653){if(!Boolean(~_0x2d9653))return _0x2d9653;return this['PSVibf'](this['tcSUPy']);},_0x5b8f5f['prototype']['PSVibf']=function(_0x1781ce){for(var _0x35e4b7=-0x67*-0x17+-0x14f5+0xbb4,_0x1ec3c4=this['TASJQm']['length'];_0x35e4b7<_0x1ec3c4;_0x35e4b7++){this['TASJQm']['push'](Math['round'](Math['random']())),_0x1ec3c4=this['TASJQm']['length'];}return _0x1781ce(this['TASJQm'][-0x1385*0x1+0x5cf*-0x5+0x3090]);},new _0x5b8f5f(_0x2a89)['sTiNgK'](),_0x2a89['RBRiiw']=!![];}_0x4cca7d=_0x2a89['BnzCCU'](_0x4cca7d,_0x17477f),_0x3f2e6c[_0x4aab6f]=_0x4cca7d;}else _0x4cca7d=_0x2ba3e5;return _0x4cca7d;},_0x2a89(_0x3f2e6c,_0x445100);}

passes.InlineFunction(ast, "_0x2a89", _0x2a89);
passes.InlineFunction(ast, "_0x47ad", () => "should not be used");
passes.NormalizeStrings(ast);
passes.ConvertToDotNotation(ast);
passes.SimplifyConstantBranches(ast);
passes.InlineTrivialOpObjects(ast);
passes.SimplifyConstantBranches(ast);
passes.InlineTrivialOpObjects(ast);
passes.SimplifyConstantBranches(ast);
passes.InlineTrivialOpObjects(ast);
passes.SimplifyConstantBranches(ast);
passes.SimplifyBooleans(ast);
passes.NormalizeStrings(ast);
passes.NormalizeNumbers(ast);
passes.RenameVariables(ast, (name) => name.startsWith("_0x"));

const output = generate.default(ast, { filename: filename }).code;
fs.writeFileSync(filename + ".beautify.js", output, { encoding: "utf-8" });
